```regexp
(?<cond>
  (?=[~?!])
  (?<cP>~)?
  (?:(?<cT>\?)|(?<cF>!))?
)?
(?<source>
  (?<rType>
    (?:
      (?<rIn>request:(?:
        (?<rInH>head(?:\[(?<rInHN>\w+)\])?)|
          (?<rInB>body)
      ))|
      (?<rOut>response:(?:
        (?<rOutH>head(?:\[(?<rOutHN>\w+)\])?)|
          (?<rOutB>body)
      ))
    )
    (?::\{
      (?<rM>.*?)
      \}(?=->|\s|$)
    )?
  )|
  (?<vType>
    (?<vbound>
      (?:(?<vC>&)(?<vT>&)?)|
      (?<vB>%)
    )?
    var
    (?:\[(?<vN>[a-zA-Z]\w*)\])?
    (?::\{(?<vM>.+?)\}(?=->|\s|$))?
  )|
  (?<uType>use
    (?:\[(?<uN>[a-zA-Z][!-+\--~]*)\])?
    (?::\{(?<uM>[\d=,.<>]+)\})?
  )
)
(?<act>->
  (?:
    (?:\{(?<aM>.*?)\}(?=\s|$))|
    (?<aV>
      (?<aSVL>
        (?:(?<aSC>&)(?<aST>&)?)|
          (?<aSB>%)
      )?
      (?<aVN>[a-zA-Z]\w*)
    )
  )
)?
```
